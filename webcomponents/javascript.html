<script type="module">
    import { codeToHtml } from "https://esm.sh/shiki@1.0.0";
  
    class CodeNetDriven extends HTMLElement {
      constructor() {
        super();
        this.attachShadow({ mode: 'open' });
        
        this.shadowRoot.innerHTML = `
          <style>
            .code-container {
              padding: 20px;
              border-radius: 8px;
              background-color: #1e1e1e;
              border: 1px solid #333;
              margin: 20px 0;
              position: relative;
              overflow: auto;
            }
            .copy-button {
              position: absolute;
              top: 10px;
              right: 10px;
              padding: 8px;
              background: transparent;
              border: 1px solid #666;
              border-radius: 4px;
              color: #fff;
              cursor: pointer;
              display: flex;
              align-items: center;
              gap: 5px;
              font-size: 12px;
              transition: background-color 0.2s;
            }
            .copy-button:hover {
              background-color: rgba(255, 255, 255, 0.1);
            }
            .copy-icon {
              width: 14px;
              height: 14px;
            }
          </style>
          <div class="code-container">
            <button class="copy-button">
              <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 4v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7.242a2 2 0 0 0-.602-1.43L16.083 2.57A2 2 0 0 0 14.685 2H10a2 2 0 0 0-2 2z"/>
                <path d="M16 18v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2"/>
              </svg>
              Copy code
            </button>
            <div class="code-content"></div>
          </div>
        `;
  
        this.shadowRoot.querySelector('.copy-button').addEventListener('click', () => {
          const code = this.getOriginalCode();
          navigator.clipboard.writeText(code).then(() => {
            const button = this.shadowRoot.querySelector('.copy-button');
            const originalText = button.innerHTML;
            button.innerHTML = `
              <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 6L9 17l-5-5"/>
              </svg>
              Copied!
            `;
            
            setTimeout(() => {
              button.innerHTML = originalText;
            }, 2000);
          });
        });
      }
  
      getOriginalCode() {
        return this.innerHTML.trim();
      }
  
      async connectedCallback() {
        const code = this.getOriginalCode();
        const language = this.getAttribute('codeFormat') || 'html';
        
        try {
          const highlightedCode = await codeToHtml(code, {
            lang: language,
            theme: 'min-dark'
          });
          
          this.shadowRoot.querySelector('.code-content').innerHTML = highlightedCode;
        } catch (error) {
          console.error('Error al resaltar el c√≥digo:', error);
        }
      }
    }
  
    customElements.define('code-net-driven', CodeNetDriven);
  </script>